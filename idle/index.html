<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Idle Kingdoms & Creatures - Terminal Cosmos</title>
  <link rel="stylesheet" href="css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>
  <div id="main-menu-screen" class="screen" aria-hidden="false">
    <div class="screen-card">
      <p class="game-kicker">Terminal Cosmos présente</p>
      <h1>Idle Kingdoms &amp; Creatures</h1>
      <p class="game-subtitle">Bâtissez votre royaume, recrutez des compagnons uniques et explorez un hub vivant.</p>
      <div class="main-menu-actions">
        <button id="start-new-game" class="primary-action">Nouveau</button>
        <button id="resume-game" class="primary-action">Reprendre</button>
        <button id="toggle-options" class="ghost-button">Options</button>
      </div>
      <div id="options-panel" class="options-panel" hidden>
        <h2>Options rapides</h2>
        <p>Personnalisez votre confort avant de partir à l'aventure.</p>
        <div class="options-grid">
          <label class="toggle">
            <input type="checkbox" id="menu-toggle-reduced-motion">
            <span>Réduire animations</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="menu-toggle-compact-ui">
            <span>Mode compact</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="menu-toggle-focus-mode">
            <span>Mode focus</span>
          </label>
        </div>
      </div>
      <p class="menu-footnote">Astuce : toutes les zones se débloquent depuis le hub plein écran.</p>
    </div>
  </div>

  <div id="hub-screen" class="screen" aria-hidden="true">
    <div class="screen-card hub-card">
      <div class="hub-header">
        <div>
          <p class="game-kicker">Hub principal</p>
          <h2>Choisissez votre destination</h2>
          <p class="game-subtitle">Traversez le monde pour récolter, miner, gérer vos pets et plus encore.</p>
        </div>
        <button id="hub-back-button" class="ghost-button">Retour menu</button>
      </div>
      <div class="hub-grid">
        <button class="hub-node" data-target="wood">
          <span>Bois</span>
          <small>Forêt d'Éveil</small>
        </button>
        <button class="hub-node" data-target="mining">
          <span>Mine</span>
          <small>Galeries profondes</small>
        </button>
        <button class="hub-node" data-target="agriculture">
          <span>Agriculture</span>
          <small>Plantations rares</small>
        </button>
        <button class="hub-node" data-target="pets">
          <span>Pets</span>
          <small>Centre des compagnons</small>
        </button>
      </div>
      <p class="menu-footnote">Cliquez sur une zone pour plonger dans l'action.</p>
    </div>
  </div>

  <div id="page">
    <header id="hud">
      <div id="player-info" class="panel card">
        <h2 id="player-name">Joueur</h2>
        <p id="player-level">Niveau : 1</p>
        <p id="player-xp">xp : 0</p>
        <p id="player-gold">Gold : 100</p>
        <p id="player-prestige">Prestige : 0 (x1.00)</p>
        <div id="resource-summary">
          <div class="resource" data-tooltip="Bois disponible pour les futures constructions.">
            <span>Bois</span>
            <strong id="resource-wood">0</strong>
          </div>
          <div class="resource" data-tooltip="Ouvrir des œufs pour obtenir des compagnons.">
            <span>Œufs</span>
            <strong id="resource-egg">0</strong>
          </div>
          <div class="resource" data-tooltip="Nectar récolté dans les serres.">
            <span>Nectar</span>
            <strong data-agri-resource="Nectar">0</strong>
          </div>
          <div class="resource" data-tooltip="Fibres récoltées dans les serres.">
            <span>Fibres</span>
            <strong data-agri-resource="Fibres">0</strong>
          </div>
          <div class="resource" data-tooltip="Tubercules récoltés dans les serres.">
            <span>Tubercules</span>
            <strong data-agri-resource="Tubercules">0</strong>
          </div>
        </div>
      </div>
      <!-- Zone de DPS -->
      <div id="dps-container" class="panel card">
        <div class="panel-header-inline">
          <h3>Combat</h3>
          <button id="toggle-dps-details" class="ghost-button" aria-expanded="false">Détails</button>
        </div>
        <div id="dps-display">
          DPS: 0
        </div>
        <div id="dps-details" aria-live="polite">
          <!-- Les détails seront affichés ici lors du clic -->
        </div>
        <div id="combat-stats">
          <div>
            <span>Dégâts de clic</span>
            <strong id="stat-click-damage">1</strong>
          </div>
          <div>
            <span>Auto DPS</span>
            <strong id="stat-auto-dps">0</strong>
          </div>
          <div>
            <span>Bonus récomp.</span>
            <strong id="stat-reward-multi">x1.0</strong>
          </div>
        </div>
      </div>
      <div id="qol-panel" class="panel card">
        <div class="panel-header-inline">
          <h3>Contrôles</h3>
          <span id="save-status">Auto-save : --</span>
        </div>
        <div class="button-row">
          <button id="save-button" data-tooltip="Sauvegarde manuelle immédiate.">Sauvegarder</button>
          <button id="load-button" data-tooltip="Charger la dernière sauvegarde locale.">Charger</button>
          <button id="reset-button" class="danger" data-tooltip="Réinitialiser la partie (irréversible).">Reset</button>
          <button id="open-hub-button" class="ghost-button">Hub</button>
        </div>
        <div class="toggle-row">
          <label class="toggle">
            <input type="checkbox" id="toggle-reduced-motion">
            <span>Réduire animations</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-compact-ui">
            <span>Mode compact</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-focus-mode">
            <span>Mode focus</span>
          </label>
        </div>
        <div class="shortcut-list">
          <span>␣ Couper</span>
          <span>E Ouvrir œuf</span>
          <span>D DPS</span>
          <span>M Milestones</span>
          <span>S Sauvegarder</span>
        </div>
        <div id="event-log" aria-live="polite"></div>
      </div>
    </header>

    <main id="content">
      <div id="main-area">
        <div id="main-menu" class="panel card" aria-label="Navigation rapide">
          <div class="panel-header-inline">
            <h3>Navigation</h3>
            <span class="menu-tag">En jeu</span>
          </div>
          <p class="menu-hint">Revenez au hub pour changer de zone principale.</p>
          <button id="open-hub-button-inline" class="menu-button">Ouvrir le hub</button>
        </div>
        <section id="meta-progression" class="panel card" aria-label="Objectifs globaux">
          <div class="panel-header-inline">
            <h3>Objectifs globaux</h3>
            <span id="prestige-summary" class="menu-tag">Prestige x1.00</span>
          </div>
          <p class="menu-hint">Atteignez des milestones transverses pour booster durablement votre royaume.</p>
          <div id="global-objectives" class="objective-list"></div>
          <div class="prestige-panel">
            <div>
              <h4>Prestige</h4>
              <p id="prestige-description">Chargez votre prestige pour obtenir un bonus permanent.</p>
              <ul id="prestige-requirements" class="objective-requirements"></ul>
            </div>
            <button id="prestige-button" class="danger">Prestige</button>
          </div>
        </section>

        <div id="game-container">
          <section id="section-wood" class="content-section is-active" data-section="wood" aria-hidden="false">
            <header class="section-header">
              <h2>Bois &amp; Forêt d'Éveil</h2>
              <p>Coupez des arbres, débloquez des améliorations et préparez le futur royaume.</p>
            </header>
            <!--<p class="intro-text">Cliquez sur l'arbre pour le couper et récolter vos ressources !</p>-->
            
            <!-- Conteneur principal de la zone "arbre" -->
            <div id="tree-container">
              <!-- Barre de milestone, cliquable pour afficher le détail -->
              <div id="tree-milestone-panel" onclick="toggleMilestoneInfo()">
                <div id="tree-milestone-container">
                  <div id="tree-milestone"></div>
                </div>
              </div>
              
              <!-- Boîte d'informations qui s'affiche au clic sur la barre -->
              <div id="milestone-details">
                <h4>Informations sur le Milestone</h4>
                <p id="milestone-text">Cliquez sur la barre à gauche pour voir les infos.</p>
              </div>

              <!-- L'arbre et ses infos (déjà existants) -->
              <div id="tree" class="tree-clickable" role="button" aria-label="Couper l'arbre" tabindex="0"></div>
              <div id="tree-info">
                <h3 id="tree-name">Nom de l'arbre</h3>
                <div id="tree-health-container">
                  <div id="tree-progress"></div>
                </div>
                <p id="tree-health">0 / 0</p>
                <p class="hint-text">Astuce : appuyez sur <strong>Espace</strong> pour couper plus vite.</p>
              </div>
            </div>

            
            <!-- Section des améliorations pour le bois -->
            <div id="wood-upgrades">
              <h3>Améliorations du Bois</h3>
              <div class="upgrade-toolbar">
                <div id="upgrade-buy-mode" class="segmented">
                  <button data-mode="1" class="active">x1</button>
                  <button data-mode="10">x10</button>
                  <button data-mode="max">xMax</button>
                </div>
                <button id="upgrade-all-button" class="ghost-button" data-tooltip="Acheter chaque upgrade avec le mode actif.">Tout améliorer</button>
              </div>
              <div class="upgrade-section">
                <p id="lumberjack-level">Niveau : 0</p>
                <p id="lumberjack-cost">Coût : 100 Gold</p>
                <button id="upgrade-lumberjack" data-tooltip="Augmente l'auto DPS.">Améliorer Bûcheron</button>
              </div>
              <div class="upgrade-section">
                <p id="sawmill-level">Niveau : 0</p>
                <p id="sawmill-cost">Coût : 500 Gold</p>
                <button id="upgrade-sawmill" data-tooltip="Gross boost d'auto DPS.">Améliorer Scierie</button>
              </div>
              <div class="upgrade-section">
                <p id="force-upgrade-level">Force Upgrade : Niveau 0</p>
                <p id="force-upgrade-cost">Coût : 200 Gold</p>
                <button id="force-upgrade-button" data-tooltip="Augmente les dégâts de clic.">Améliorer la Force</button>
              </div>
            </div>
          </section>

          <section id="section-mining" class="content-section" data-section="mining" aria-hidden="true">
            <header class="section-header">
              <h2>Minage</h2>
              <p>Explorez une grille 10x10, découvrez des minerais rares et descendez toujours plus bas.</p>
            </header>
            <div class="mining-layout">
              <div class="mining-panel card">
                <div class="panel-header-inline">
                  <h3>Galerie - Étage <span id="mine-floor">1</span></h3>
                  <span id="mine-progress" class="mine-progress">0/100</span>
                </div>
                <div id="mine-grid" class="mine-grid" role="grid" aria-label="Grille de minage 10 par 10"></div>
                <div class="mining-actions">
                  <button id="mine-reset-grid" class="ghost-button">Recommencer l'étage</button>
                  <button id="mine-scan-grid" class="ghost-button">Scanner</button>
                </div>
                <div class="mining-insights">
                  <div class="insight-card">
                    <span>Chance minerai</span>
                    <strong id="mine-odds">--%</strong>
                  </div>
                  <div class="insight-card">
                    <span>Bonus combo</span>
                    <strong id="mine-combo-bonus">x1.00</strong>
                  </div>
                  <div class="insight-card">
                    <span>Série</span>
                    <strong id="mine-combo">0</strong>
                    <small id="mine-combo-best">Record : 0</small>
                  </div>
                  <label class="toggle mining-toggle">
                    <input type="checkbox" id="mine-auto-descend" checked>
                    <span>Auto-descente</span>
                  </label>
                </div>
                <p class="hint-text">Cliquez sur une case pour révéler un minerai, du vide, une échelle ou un trou.</p>
                <div id="mine-log" class="mining-log" aria-live="polite"></div>
              </div>
              <div class="mining-panel card">
                <h3>Inventaire minier</h3>
                <div id="mine-ore-list" class="ore-list"></div>
              </div>
              <div class="mining-panel card">
                <h3>Améliorations de la mine</h3>
                <div id="mine-upgrades" class="upgrade-list">
                  <div class="upgrade-card" data-upgrade="quarry">
                    <div>
                      <h4>Quarry directionnelle</h4>
                      <p class="upgrade-desc">Mine automatiquement de haut en bas, colonne par colonne.</p>
                      <p class="upgrade-level" data-upgrade-level></p>
                      <p class="upgrade-cost" data-upgrade-cost></p>
                    </div>
                    <button class="upgrade-button" data-upgrade-button>Acheter</button>
                  </div>
                  <div class="upgrade-card" data-upgrade="randomStrike">
                    <div>
                      <h4>Frappes erratiques</h4>
                      <p class="upgrade-desc">Tape aléatoirement une case de la grille.</p>
                      <p class="upgrade-level" data-upgrade-level></p>
                      <p class="upgrade-cost" data-upgrade-cost></p>
                    </div>
                    <button class="upgrade-button" data-upgrade-button>Acheter</button>
                  </div>
                  <div class="upgrade-card" data-upgrade="pickaxePower">
                    <div>
                      <h4>Renfort de pioche</h4>
                      <p class="upgrade-desc">Augmente l'or et l'XP obtenus en minant.</p>
                      <p class="upgrade-level" data-upgrade-level></p>
                      <p class="upgrade-cost" data-upgrade-cost></p>
                    </div>
                    <button class="upgrade-button" data-upgrade-button>Acheter</button>
                  </div>
                  <div class="upgrade-card" data-upgrade="pickaxePrecision">
                    <div>
                      <h4>Affûtage</h4>
                      <p class="upgrade-desc">Augmente les chances de trouver un minerai.</p>
                      <p class="upgrade-level" data-upgrade-level></p>
                      <p class="upgrade-cost" data-upgrade-cost></p>
                    </div>
                    <button class="upgrade-button" data-upgrade-button>Acheter</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section id="section-agriculture" class="content-section" data-section="agriculture" aria-hidden="true">
            <header class="section-header">
              <h2>Agriculture - Serres des Éclats</h2>
              <p>Orchestrez des cycles courts, enchaînez les récoltes pour déclencher l'Éclosion et booster votre royaume.</p>
            </header>
            <div class="agriculture-layout">
              <div class="agri-panel card">
                <div class="panel-header-inline">
                  <h3>Terrasses vivantes</h3>
                  <label class="toggle">
                    <input type="checkbox" id="agri-auto-harvest">
                    <span>Auto-récolte</span>
                  </label>
                </div>
                <p class="agri-hint">Alternez les cultures pour monter l'inspiration et activer une Éclosion surpuissante.</p>
                <div id="agri-plots" class="agri-plots"></div>
              </div>
              <div class="agri-panel card">
                <h3>Serre tactique</h3>
                <div class="agri-status">
                  <div class="agri-status-card">
                    <span>Météo cosmique</span>
                    <div id="agri-weather" class="agri-weather"></div>
                  </div>
                  <div class="agri-status-card">
                    <span>Éclosion</span>
                    <div class="agri-bloom">
                      <div class="agri-bloom-fill" id="agri-bloom-fill"></div>
                    </div>
                    <p id="agri-bloom-status">Inspiration : 0/100</p>
                    <button id="agri-bloom-button" class="primary-action" disabled>Déclencher l'Éclosion</button>
                  </div>
                </div>
                <h4>Ressources récoltées</h4>
                <div id="agri-storage" class="agri-storage"></div>
                <h4>Affinités par culture</h4>
                <div id="agri-focus" class="agri-focus"></div>
              </div>
              <div class="agri-panel card">
                <h3>Améliorations agricoles</h3>
                <div id="agri-upgrades" class="upgrade-list"></div>
                <h4>Journal des récoltes</h4>
                <div id="agri-log" class="agri-log" aria-live="polite"></div>
              </div>
            </div>
          </section>

          <section id="section-pets" class="content-section" data-section="pets" aria-hidden="true">
            <header class="section-header">
              <h2>Centre des Compagnons</h2>
              <p>Ouvrez des œufs, équipez vos pets et gérez votre équipe active.</p>
            </header>
            <div id="pet-panel">
              <div class="panel-header">
                <h3>Compagnons</h3>
                <div class="egg-counter">
                  <span>Œufs :</span>
                  <strong id="egg-count">0</strong>
                </div>
                <div class="egg-counter">
                  <span>Équipés :</span>
                  <strong id="pet-equipped-count">0/3</strong>
                </div>
              </div>
              <div id="pet-slots">
                <div class="pet-slot" data-slot="0">
                  <span>Slot 1</span>
                  <button class="unequip-button" data-slot="0">Retirer</button>
                </div>
                <div class="pet-slot" data-slot="1">
                  <span>Slot 2</span>
                  <button class="unequip-button" data-slot="1">Retirer</button>
                </div>
                <div class="pet-slot" data-slot="2">
                  <span>Slot 3</span>
                  <button class="unequip-button" data-slot="2">Retirer</button>
                </div>
              </div>
              <button id="unequip-all-button" class="ghost-button">Tout retirer</button>
              <button id="open-egg-button">Ouvrir un œuf</button>
              <div id="pet-collection"></div>
            </div>
          </section>
        </div>
      </div>

      <!-- Menu latéral à droite -->
      <aside id="sidebar">
        <h3>Liste des Arbres</h3>
        <div class="tree-menu-controls">
          <input id="tree-search" type="search" placeholder="Rechercher un arbre..." aria-label="Rechercher un arbre">
          <select id="tree-filter" aria-label="Filtrer par rareté">
            <option value="all">Toutes raretés</option>
            <option value="common">Commun</option>
            <option value="uncommon">Inhabituel</option>
            <option value="rare">Rare</option>
            <option value="epic">Épique</option>
          </select>
        </div>
        <div id="tree-menu"></div>
      </aside>
    </main>
  </div>
  <div id="focus-toolbar" class="focus-toolbar" aria-hidden="true">
    <span class="focus-label">Mode focus</span>
    <div class="focus-actions">
      <button class="ghost-button" data-focus-target="player-info">Infos</button>
      <button class="ghost-button" data-focus-target="dps-container">Combat</button>
      <button class="ghost-button" data-focus-target="qol-panel">Contrôles</button>
      <button class="ghost-button" data-focus-target="main-menu">Navigation</button>
      <button class="ghost-button" data-focus-target="meta-progression">Objectifs</button>
      <button class="ghost-button" data-focus-target="sidebar">Arbres</button>
    </div>
  </div>
  <div id="focus-overlay" class="focus-overlay" aria-hidden="true">
    <button id="focus-close" class="ghost-button focus-close" type="button">Fermer</button>
  </div>
  <!-- Panneau Modal pour afficher les détails d'un arbre -->
  <div id="tree-detail-modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeTreeDetailModal()" aria-label="Fermer la fenêtre">X</span>
      <h3 id="modal-tree-name">Nom de l'arbre</h3>
      <div id="modal-tree-info">
        <!-- Détails à remplir dynamiquement (ex : HP max, gold reward, woodReward, rareté, taux de drop, spawn, milestone, etc.) -->
        <p id="modal-tree-detail-text">Ici s'affichent toutes les informations détaillées de l'arbre.</p>
      </div>
    </div>
  </div>
  <div id="pet-detail-modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closePetDetailModal()" aria-label="Fermer la fenêtre">X</span>
      <h3 id="modal-pet-name">Nom du compagnon</h3>
      <div id="modal-pet-info">
        <p id="modal-pet-detail-text">Ici s'affichent les statistiques détaillées du compagnon.</p>
      </div>
    </div>
  </div>
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
  <script type="module" src="js/main.js"></script>
  <script>
    // Fonction pour fermer le modal
    function closeTreeDetailModal() {
      document.getElementById('tree-detail-modal').style.display = 'none';
    }
    // Fonction pour ouvrir et remplir le modal (vous pourrez l'appeler depuis votre module TreeMenu)
    function openTreeDetailModal(detailsHTML) {
      const modal = document.getElementById('tree-detail-modal');
      document.getElementById('modal-tree-info').innerHTML = detailsHTML;
      modal.style.display = 'block';
    }
    function closePetDetailModal() {
      document.getElementById('pet-detail-modal').style.display = 'none';
    }
    function openPetDetailModal(detailsHTML, petName = 'Compagnon') {
      const modal = document.getElementById('pet-detail-modal');
      document.getElementById('modal-pet-name').textContent = petName;
      document.getElementById('modal-pet-info').innerHTML = detailsHTML;
      modal.style.display = 'block';
    }
  </script>
</body>
</html>
